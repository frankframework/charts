{{/*
ConfigMap for generating default environment variables for the app
*/}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "frank-console.fullname" . }}-env
  labels:
    {{- include "frank-console.labels" . | nindent 4 }}
data:
  management.gateway.outbound.class: "org.frankframework.management.gateway.HazelcastOutboundGateway"
  {{- with .Values.application }}
  JAVA_OPTS: "\
  {{- with .memory }}
  {{- if .percentage }}
  -XX:InitialRAMPercentage={{ .minimum }} \
  -XX:MaxRAMPercentage={{ .maximum }} \
  {{- else }}
  -Xms{{ .minimum }} -Xmx{{ .maximum }}
  {{- end }}
  {{- end }}
  -XX:HeapDumpPath=/heap-dumps/$(hostname)-$(date --iso-8601=seconds).hprof \
  -XX:+HeapDumpOnOutOfMemoryError \
  -XX:+ExitOnOutOfMemoryError \
  {{ .javaOpts }}"
  TZ: "{{ $.Values.timeZone }}"
  application.security.http.authentication: "{{ .security.http.authentication }}"
  # Reverse proxy/ingress should be used for https
  application.security.http.transportGuarantee: "NONE"
  {{- if .security.http.authentication }}
  {{- if .security.http.activeDirectory.enabled }}
  {{- with .security.http.activeDirectory }}
  application.security.console.authentication.type: "AD"
  application.security.console.authentication.baseDn: "{{ .baseDn }}"
  application.security.console.authentication.url: "{{ .url }}"
  {{- end }}
  {{- end }}
  {{- if .security.http.localUsers }}
  application.security.console.authentication.type: "YML"
  {{- end }}
  {{- end }}
  helm.release.version: "{{ $.Chart.Version }}"
  container.image: "{{ $.Values.image.registry }}{{ if $.Values.image.registry }}/{{ end }}{{ $.Values.image.repository }}:{{ $.Values.image.tag | default $.Chart.AppVersion }}"
  {{- end -}}
